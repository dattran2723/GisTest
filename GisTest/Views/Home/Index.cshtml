@model IEnumerable<GisTest.Models.ListObjectViewModel>
@{
    ViewBag.Title = "Home Page";
}
@section css{
    <link href="~/Content/css/Index.css" rel="stylesheet" />
}
<div class="row w-100 ml-0 mr-0" id="Home">
    <div class="col-3" id="listCity">
        <label>Danh sách bản đồ</label>
        <ul class="menu-first">
            @foreach (var item in Model)
            {
                <li class="node">
                    <a href="javascript:;" data-id="@item.Value" class="node-item">
                        <span>@Html.DisplayFor(modelItem => item.Ten)</span>
                        <span class="node-icon">
                            <i class="fa fa-angle-left"></i>
                        </span>
                    </a>
                </li>
            }
        </ul>
    </div>
    <div class="col-9" id="xinkciti-map">
    </div>
</div>

<a href="javascript:;" id="hidden-listCity"><i class="fa fa-angle-left"></i></a>
<div id="show-info" class="row mr-0">
    <a href="javascript:;" id="hidden-info" class="float-right"><i class="fa fa-angle-right"></i></a>
    <div class="content-info float-right">
        <h4 class="w-100 text-center mb-4 mt-4">Thông tin bản đồ</h4>
        <div class="row item-info">
            <label class="col-6">Quốc gia:</label>
            <label class="col-6">Việt Nam</label>
        </div>
        <div class="load-info">
        </div>
    </div>
</div>
@section scripts{
    <script src="~/Scripts/js/GetListMenu.js"></script>
    <script src="http://map.map4d.vn/data/jquery.cookie.min.js"></script>
    <script src="http://map.map4d.vn/data/react.production.min.js"></script>
    <script src="http://map.map4d.vn/data/react-dom.production.min.js"></script>
    <script src="http://map.map4d.vn/data/redux.min.js"></script>
    <link href="http://map.map4d.vn/styles/main.css" rel="stylesheet">
    <script src="http://map.map4d.vn/build/mapgl.bundle.js"></script>
    <script>
        $(function () {
            var map, dulieuve, ve, pLat, pLng, zoom;
            var paramMapDefault = {
                lat: 10.167615,
                lng: 106.411514,
                zoom: 11,
                mode: "2d"
            };
            paramMap = {
                mode: paramMapDefault.mode,
                center: { lat: paramMapDefault.lat, lon: paramMapDefault.lng },
                tilt: 60,
                rotation: 0,
                zoom: paramMapDefault.zoom,
                plugins: [
                    //MapGL.SearchComponent
                ]
            }
            map = MapGL.initMap("xinkciti-map", paramMap);

            //sự kiện click vào địa điểm trên danh sách bản đổ
            $("#listCity").on('click', '.node-item', function () {
                if (map.leaflet.hasLayer(ve)) {
                    map.leaflet.removeLayer(ve);
                }
                var value = $(this).attr("data-id");
                var cod = GetThongTin(value);
                //vẽ layer lên bản đồ
                //console.log(JSON.stringify(dulieuve));
                ve = new L.GeoJSON(JSON.parse(dulieuve));
                map.leaflet.addLayer(ve);

                //zoom đến địa điểm
                map.leaflet.setView([pLat, pLng], zoom);
                //add html để hiển thị thông tin
                $(".load-info").html(cod);
                $("#show-info").css("display", "flex");
            });

            function GetThongTin(e) {
                var codeHtml = "";
                $.ajax({
                    url: "/Home/GetFullThongTinDoiTuongByValue?value=" + e,
                    type: 'get',
                    async: false,
                    success: function (data) {
                        dulieuve = ' {"type": "FeatureCollection","features": [' + data[0].DuLieuVe + ']}';
                        pLat = data[0].Lat;
                        pLng = data[0].Lng;
                        zoom = data[0].Zoom;
                        data.forEach(function (item) {
                            codeHtml = '<div class="row item-info"><label class="col-6 ' + item.Code.replace("/", "") + '" ></label ><label class="col-6">' + item.Ten + '</label></div >' + codeHtml;
                        });
                        codeHtml = codeHtml + '<div class="row item-info"><label class="col-6" >Tên:</label ><label class="col-6">' + data[0].Ten + '</label></div >';
                    }
                });
                return codeHtml;
            };
            map.leaflet.on('click', function (e) {
                console.log("Lat, Lon : " + e.latlng.lat + ", " + e.latlng.lng)
            });
        });
    </script>
}
